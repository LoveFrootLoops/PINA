<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>1. Tutorial 1: resolution of a Poisson problem &mdash; PINA 0.0.2 documentation</title><link rel="stylesheet" href="../../_static/css/theme.css" type="text/css" />
    <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="../../_static/graphviz.css" type="text/css" />
  <!--[if lt IE 9]>
    <script src="../../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  <script id="documentation_options" data-url_root="../../" src="../../_static/documentation_options.js"></script>
        <script src="../../_static/jquery.js"></script>
        <script src="../../_static/underscore.js"></script>
        <script src="../../_static/doctools.js"></script>
        <script src="../../_static/language_data.js"></script>
        <script async="async" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/latest.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <script src="../../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="prev" title="License" href="../../LICENSE.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
            <a href="../../index.html" class="icon icon-home"> PINA
          </a>
              <div class="version">
                0.0.2
              </div>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption"><span class="caption-text">Package Documentation:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../installation.html">Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../code.html">API</a></li>
<li class="toctree-l1"><a class="reference internal" href="../contributing.html">Contributing</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../LICENSE.html">License</a></li>
</ul>
<p class="caption"><span class="caption-text">Tutorials:</span></p>
<ul class="current">
<li class="toctree-l1 current"><a class="current reference internal" href="#">1. Poisson problem</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#the-problem-definition">1.1. The problem definition</a></li>
<li class="toctree-l2"><a class="reference internal" href="#the-problem-solution">1.2. The problem solution</a></li>
<li class="toctree-l2"><a class="reference internal" href="#the-problem-solution-with-extra-features">1.3. The problem solution with extra-features</a></li>
<li class="toctree-l2"><a class="reference internal" href="#the-problem-solution-with-learnable-extra-features">1.4. The problem solution with learnable extra-features</a></li>
</ul>
</li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../index.html">PINA</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../../index.html" class="icon icon-home"></a> &raquo;</li>
      <li><span class="section-number">1. </span>Tutorial 1: resolution of a Poisson problem</li>
      <li class="wy-breadcrumbs-aside">
            <a href="../../_sources/_rst/tutorial1/tutorial-1.rst.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <div class="section" id="tutorial-1-resolution-of-a-poisson-problem">
<h1><span class="section-number">1. </span>Tutorial 1: resolution of a Poisson problem<a class="headerlink" href="#tutorial-1-resolution-of-a-poisson-problem" title="Permalink to this headline">¶</a></h1>
<div class="section" id="the-problem-definition">
<h2><span class="section-number">1.1. </span>The problem definition<a class="headerlink" href="#the-problem-definition" title="Permalink to this headline">¶</a></h2>
<p>This tutorial presents how to solve with Physics-Informed Neural
Networks a 2-D Poisson problem with Dirichlet boundary conditions.</p>
<p>The problem is written as: <a href="#id1"><span class="problematic" id="id2">:raw-latex:`\begin{equation}
\begin{cases}
\Delta u = \sin{(\pi x)} \sin{(\pi y)} \text{ in } D, \\
u = 0 \text{ on } \Gamma_1 \cup \Gamma_2 \cup \Gamma_3 \cup \Gamma_4,
\end{cases}
\end{equation}`</span></a>
where <span class="math notranslate nohighlight">\(D\)</span> is a square domain <span class="math notranslate nohighlight">\([0,1]^2\)</span>, and
<span class="math notranslate nohighlight">\(\Gamma_i\)</span>, with <span class="math notranslate nohighlight">\(i=1,...,4\)</span>, are the boundaries of the
square.</p>
<p>First of all, some useful imports.</p>
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span>import os
import numpy as np
import argparse
import sys
import torch
from torch.nn import ReLU, Tanh, Softplus
from pina.problem import SpatialProblem
from pina.operators import nabla
from pina.model import FeedForward
from pina.adaptive_functions import AdaptiveSin, AdaptiveCos, AdaptiveTanh
from pina import Condition, Span, PINN, LabelTensor, Plotter
</pre></div>
</div>
<p>Now, the Poisson problem is written in PINA code as a class. The
equations are written as <em>conditions</em> that should be satisfied in the
corresponding domains. <em>truth_solution</em> is the exact solution which will
be compared with the predicted one.</p>
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span>class Poisson(SpatialProblem):
    spatial_variables = [&#39;x&#39;, &#39;y&#39;]
    bounds_x = [0, 1]
    bounds_y = [0, 1]
    output_variables = [&#39;u&#39;]
    domain = Span({&#39;x&#39;: bounds_x, &#39;y&#39;: bounds_y})

    def laplace_equation(input_, output_):
        force_term = (torch.sin(input_[&#39;x&#39;]*torch.pi) *
                      torch.sin(input_[&#39;y&#39;]*torch.pi))
        return nabla(output_[&#39;u&#39;], input_).flatten() - force_term

    def nil_dirichlet(input_, output_):
        value = 0.0
        return output_[&#39;u&#39;] - value

    conditions = {
        &#39;gamma1&#39;: Condition(
            Span({&#39;x&#39;: bounds_x, &#39;y&#39;:  bounds_y[-1]}), nil_dirichlet),
        &#39;gamma2&#39;: Condition(
            Span({&#39;x&#39;: bounds_x, &#39;y&#39;: bounds_y[0]}), nil_dirichlet),
        &#39;gamma3&#39;: Condition(
            Span({&#39;x&#39;:  bounds_x[-1], &#39;y&#39;: bounds_y}), nil_dirichlet),
        &#39;gamma4&#39;: Condition(
            Span({&#39;x&#39;: bounds_x[0], &#39;y&#39;: bounds_y}), nil_dirichlet),
        &#39;D&#39;: Condition(
            Span({&#39;x&#39;: bounds_x, &#39;y&#39;: bounds_y}), laplace_equation),
    }
    def poisson_sol(self, x, y):
        return -(np.sin(x*np.pi)*np.sin(y*np.pi))/(2*np.pi**2)

    truth_solution = poisson_sol
</pre></div>
</div>
</div>
<div class="section" id="the-problem-solution">
<h2><span class="section-number">1.2. </span>The problem solution<a class="headerlink" href="#the-problem-solution" title="Permalink to this headline">¶</a></h2>
<p>Then, a feed-forward neural network is defined, through the class
<em>FeedForward</em>. A 2-D grid is instantiated inside the square domain and
on the boundaries. This neural network takes as input the coordinates of
the points which compose the grid and gives as output the solution of
the Poisson problem. The residual of the equations are evaluated at each
point of the grid and the loss minimized by the neural network is the
sum of the residuals. In this tutorial, the neural network is composed
by two hidden layers of 10 neurons each, and it is trained for 5000
epochs with a learning rate of 0.003. These parameters can be modified
as desired. The output of the cell below is the final loss of the
training phase of the PINN.</p>
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span>poisson_problem = Poisson()

model = FeedForward(layers=[10, 10],
                    output_variables=poisson_problem.output_variables,
                    input_variables=poisson_problem.input_variables)

pinn = PINN(poisson_problem, model, lr=0.003, regularizer=1e-8)
pinn.span_pts(20, &#39;grid&#39;, locations=[&#39;gamma1&#39;, &#39;gamma2&#39;, &#39;gamma3&#39;, &#39;gamma4&#39;])
pinn.span_pts(20, &#39;grid&#39;, locations=[&#39;D&#39;])
pinn.train(5000, 100)
</pre></div>
</div>
<p>The loss trend is saved in a dedicated txt file located in
<em>tutorial1_files</em>.</p>
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span>os.mkdir(&#39;tutorial1_files&#39;)
with open(&#39;tutorial1_files/poisson_history.txt&#39;, &#39;w&#39;) as file_:
    for i, losses in enumerate(pinn.history):
        file_.write(&#39;{} {}\n&#39;.format(i, sum(losses)))
pinn.save_state(&#39;tutorial1_files/pina.poisson&#39;)
</pre></div>
</div>
<p>Now the <em>Plotter</em> class is used to plot the results. The solution
predicted by the neural network is plotted on the left, the exact one is
represented at the center and on the right the error between the exact
and the predicted solutions is showed.</p>
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span>plotter = Plotter()
plotter.plot(pinn)
</pre></div>
</div>
<img alt="../../_images/output_13_0.png" src="../../_images/output_13_0.png" />
</div>
<div class="section" id="the-problem-solution-with-extra-features">
<h2><span class="section-number">1.3. </span>The problem solution with extra-features<a class="headerlink" href="#the-problem-solution-with-extra-features" title="Permalink to this headline">¶</a></h2>
<p>Now, the same problem is solved in a different way. A new neural network
is now defined, with an additional input variable, named extra-feature,
which coincides with the forcing term in the Laplace equation. The set
of input variables to the neural network is:</p>
<p><a href="#id3"><span class="problematic" id="id4">:raw-latex:`\begin{equation}
[\mathbf{x}, \mathbf{y}, \mathbf{k}(\mathbf{x}, \mathbf{y})], \text{ with } \mathbf{k}(\mathbf{x}, \mathbf{y})=\sin{(\pi \mathbf{x})}\sin{(\pi \mathbf{y})},
\end{equation}`</span></a></p>
<p>where <span class="math notranslate nohighlight">\(\mathbf{x}\)</span> and <span class="math notranslate nohighlight">\(\mathbf{y}\)</span> are the coordinates of
the points of the grid and <span class="math notranslate nohighlight">\(\mathbf{k}(\mathbf{x}, \mathbf{y})\)</span> is
the forcing term evaluated at the grid points.</p>
<p>This forcing term is initialized in the class <em>myFeature</em>, the output of
the cell below is also in this case the final loss of PINN.</p>
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span>poisson_problem = Poisson()

class myFeature(torch.nn.Module):
    &quot;&quot;&quot;
    &quot;&quot;&quot;
    def __init__(self):
        super(myFeature, self).__init__()

    def forward(self, x):
        return LabelTensor(torch.sin(x.extract([&#39;x&#39;])*torch.pi) *
                torch.sin(x.extract([&#39;y&#39;])*torch.pi), &#39;k&#39;)

feat = [myFeature()]
model_feat = FeedForward(layers=[10, 10],
                    output_variables=poisson_problem.output_variables,
                    input_variables=poisson_problem.input_variables,
                    extra_features=feat)

pinn_feat = PINN(poisson_problem, model_feat, lr=0.003, regularizer=1e-8)
pinn_feat.span_pts(20, &#39;grid&#39;, locations=[&#39;gamma1&#39;, &#39;gamma2&#39;, &#39;gamma3&#39;, &#39;gamma4&#39;])
pinn.feat_span_pts(20, &#39;grid&#39;, locations=[&#39;D&#39;])
pinn_feat.train(5000, 100)
</pre></div>
</div>
<p>The losses are saved in a txt file as for the basic Poisson case.</p>
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span>with open(&#39;tutorial1_files/poisson_history_feat.txt&#39;, &#39;w&#39;) as file_:
        for i, losses in enumerate(pinn_feat.history):
            file_.write(&#39;{} {}\n&#39;.format(i, sum(losses)))
pinn_feat.save_state(&#39;tutorial1_files/pina.poisson_feat&#39;)
</pre></div>
</div>
<p>The predicted and exact solutions and the error between them are
represented below.</p>
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span>plotter_feat = Plotter()
plotter_feat.plot(pinn_feat)
</pre></div>
</div>
<img alt="../../_images/output_20_0.png" src="../../_images/output_20_0.png" />
</div>
<div class="section" id="the-problem-solution-with-learnable-extra-features">
<h2><span class="section-number">1.4. </span>The problem solution with learnable extra-features<a class="headerlink" href="#the-problem-solution-with-learnable-extra-features" title="Permalink to this headline">¶</a></h2>
<p>Another way to predict the solution is to add a parametric extra-feature.
The parameters added in the
expression of the extra-feature are learned during the training phase of
the neural network. For example, considering two parameters, the
parameteric extra-feature is written as:</p>
<p><a href="#id5"><span class="problematic" id="id6">:raw-latex:`\begin{equation}
\mathbf{k}(\mathbf{x}, \mathbf{y}) = \beta \sin{(\alpha \mathbf{x})} \sin{(\alpha \mathbf{y})}
\end{equation}`</span></a></p>
<p>Here, as done for the other cases, the new parametric feature is defined
and the neural network is re-initialized and trained.</p>
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span>class LearnableFeature(torch.nn.Module):
    &quot;&quot;&quot;
    &quot;&quot;&quot;
    def __init__(self):
        super(myFeature, self).__init__()
        self.beta = torch.nn.Parameter(torch.Tensor([1.0]))
        self.alpha = torch.nn.Parameter(torch.Tensor([1.0]))

    def forward(self, x):
        return LabelTensor(
            self.beta*torch.sin(self.alpha*x.extract([&#39;x&#39;])*torch.pi)*
                      torch.sin(self.alpha*x.extract([&#39;y&#39;])*torch.pi),
            &#39;k&#39;)

feat = [LearnableFeature()]
model_learn = FeedForward(layers=[10, 10],
                    output_variables=param_poisson_problem.output_variables,
                    input_variables=param_poisson_problem.input_variables,
                    extra_features=feat)

pinn_learn = PINN(poisson_problem, model_feat, lr=0.003, regularizer=1e-8)
pinn_learn.span_pts(20, &#39;grid&#39;, [&#39;D&#39;])
pinn_learn.span_pts(20, &#39;grid&#39;, [&#39;gamma1&#39;, &#39;gamma2&#39;, &#39;gamma3&#39;, &#39;gamma4&#39;])
pinn_learn.train(5000, 100)
</pre></div>
</div>
<p>The losses are saved as for the other two cases trained above.</p>
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span>with open(&#39;tutorial1_files/poisson_history_learn_feat.txt&#39;, &#39;w&#39;) as file_:
    for i, losses in enumerate(pinn_learn.history):
        file_.write(&#39;{} {}\n&#39;.format(i, sum(losses)))
pinn_learn.save_state(&#39;tutorial1_files/pina.poisson_learn_feat&#39;)
</pre></div>
</div>
<p>Here the plots for the prediction error (below on the right) shows that
the prediction coming from the latter version is more accurate than
the one of the basic version of PINN.</p>
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span>plotter_learn = Plotter()
plotter_learn.plot(pinn_learn)
</pre></div>
</div>
<img alt="../../_images/output_29_0.png" src="../../_images/output_29_0.png" />
<p>Now the files containing the loss trends for the three cases are read.
The loss histories are compared; we can see that the loss decreases
faster in the cases of PINN with extra-feature.</p>
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span>import pandas as pd

df = pd.read_csv(&quot;tutorial1_files/poisson_history.txt&quot;, sep=&quot; &quot;, header=None)
epochs = df[0]
poisson_data = epochs.to_numpy()*100
basic = df[1].to_numpy()

df_feat = pd.read_csv(&quot;tutorial1_files/poisson_history_feat.txt&quot;, sep=&quot; &quot;, header=None)
feat = df_feat[1].to_numpy()

df_learn = pd.read_csv(&quot;tutorial1_files/poisson_history_learn_feat.txt&quot;, sep=&quot; &quot;, header=None)
learn_feat = df_learn[1].to_numpy()

import matplotlib.pyplot as plt
plt.semilogy(epochs, basic, label=&#39;Basic PINN&#39;)
plt.semilogy(epochs, feat, label=&#39;PINN with extra-feature&#39;)
plt.semilogy(epochs, learn_feat, label=&#39;PINN with learnable extra-feature&#39;)
plt.legend()
plt.grid()
plt.show()
</pre></div>
</div>
<img alt="../../_images/output_31_0.png" src="../../_images/output_31_0.png" />
</div>
</div>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="../../LICENSE.html" class="btn btn-neutral float-left" title="License" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright Copyright 2021-2021, PINA contributors.
      <span class="lastupdated">Last updated on Jul 11, 2022.
      </span></p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>